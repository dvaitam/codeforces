package main

import (
	"bytes"
	"fmt"
	"os"
	"os/exec"
	"strconv"
	"strings"
)

var rawTestcases = []string{
	"943885643",
	"9539",
	"522509092554457696",
	"629072",
	"7",
	"931864282",
	"291",
	"89664440644888553",
	"20829657086930",
	"823570393426",
	"973",
	"813271664465951",
	"8704366660",
	"929450678201",
	"5501318705056246292",
	"4802227080862",
	"911824345448",
	"278209280513793",
	"825278081850116",
	"59756851250220593060",
	"6092516075",
	"94497620743615110502",
	"9057877108640",
	"11551702840065282",
	"223950",
	"6033452353267592",
	"9029062200580",
	"31",
	"60669",
	"32583861269",
	"166376363769",
	"448",
	"809973409561",
	"526066617972257629",
	"15525780342954604",
	"606463522195206967",
	"168",
	"222323082759451642",
	"85826843656",
	"8466122099813998",
	"4926",
	"601",
	"5175947328818202",
	"69376409262790619",
	"5387079148786",
	"4238524927117696",
	"147314251202983006",
	"971785510337443075",
	"51149635623437546",
	"21658735564564174172",
	"325731667879",
	"36847358017563609061",
	"352125030",
	"6",
	"721993173089618233",
	"7063609409555",
	"298141140292639",
	"36881817187",
	"2785264619853735",
	"6070867363477237",
	"5792813481",
	"25",
	"59",
	"763673",
	"605835",
	"889962",
	"79397037958300023793",
	"8645",
	"3258576757123126",
	"835006316996830",
	"87468",
	"119703695410390985",
	"74197",
	"366853941",
	"25",
	"9718765601692201630",
	"461545938",
	"258802704525198614",
	"19270835183236397",
	"245833752480",
	"545",
	"19",
	"4",
	"2438",
	"571688611975243640",
	"5",
	"558",
	"4382490664",
	"587716528",
	"37",
	"9314122705861",
	"74466702",
	"53323422848023623",
	"292384073062686368",
	"71218010367465641",
	"933008",
	"737",
	"98409",
	"55548",
	"207396574",
}

func solveCase(p string) int {
	n := len(p)
	if n == 0 {
		return 0
	}
	leaves := 1
	for i := 1; i < n; i++ {
		if p[i] != '0' {
			leaves++
		}
	}
	if n >= 2 && p[1] != '0' && p[0] < p[1] {
		leaves--
	}
	return leaves
}

func run(bin, input string) (string, error) {
	cmd := exec.Command(bin)
	cmd.Stdin = strings.NewReader(input)
	var out bytes.Buffer
	cmd.Stdout = &out
	cmd.Stderr = &out
	if err := cmd.Run(); err != nil {
		return "", fmt.Errorf("runtime error: %v, output: %s", err, out.String())
	}
	return strings.TrimSpace(out.String()), nil
}

func main() {
	if len(os.Args) != 2 {
		fmt.Println("usage: go run verifierC.go /path/to/binary")
		os.Exit(1)
	}
	bin := os.Args[1]
	for idx, p := range rawTestcases {
		expected := strconv.Itoa(solveCase(p))
		got, err := run(bin, p+"\n")
		if err != nil {
			fmt.Printf("case %d failed: %v\n", idx+1, err)
			os.Exit(1)
		}
		if got != expected {
			fmt.Printf("case %d failed: expected %s got %s\n", idx+1, expected, got)
			os.Exit(1)
		}
	}
	fmt.Printf("All %d tests passed\n", len(rawTestcases))
}
