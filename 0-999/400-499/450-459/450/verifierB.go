package main

import (
	"bytes"
	"fmt"
	"os"
	"os/exec"
	"strconv"
	"strings"
)

// Embedded testcases from testcasesB.txt.
const rawTestcasesData = `
-323969927 -156793510 2
642248254 364879626 590735416
-127226603 440723811 305226043
279176886 -683268685 868019975
861028817 -342659863 1098420743
-871476978 -650149582 269256804
917336346 -712331350 1955543128
32709557 514648223 1378455541
538186127 640824511 1553863877
-899682964 567252804 1769010855
115849995 -906646265 5
484316046 598045343 1497475661
355537578 -168355649 387022493
-259765934 718301611 1258174917
745902967 -822190364 173365120
202154017 -625424414 1746545875
-429663873 -567057606 1718417752
-439583008 -295758164 1504109657
521863083 -454792628 1680039881
-443274577 111185356 980280865
954203182 -666713920 4
186971090 -671823431 82895321
358378125 257357504 380031608
377717390 99989256 72575707
924080220 627131013 678777066
756212418 -846147298 414221727
392428260 698699731 980428254
311882029 -487349946 1744331863
-15012858 121550825 342286790
523705703 -283457923 1959941164
407046971 -710355443 5
-877240080 167034523 176988175
762212705 111689319 737408958
-994716137 745822789 1664010024
-828229034 -776701789 918549722
304684079 -243398317 1224654502
-30237967 -278859115 1789948711
-188110640 100369340 777506949
806705057 849972814 1367020172
-744778559 -707709256 680519381
-370801931 -198095319 1596554942
-775568087 105089080 1796011457
-712379156 -233417303 6
-936244611 -605668334 4
544944140 -989830682 687797009
-124695971 -700313134 1306779086
-345272208 -769908523 1255813084
-920936524 -393056461 1946663183
-299518940 -504955241 1461254366
-180868098 -93992558 1
-284346033 902723046 1884438950
-544870970 965548059 182290571
473579479 -357429320 1042502445
-775315147 -123748500 8
-695358534 175314055 3
286376221 540974029 6
-709737494 -685840306 4
932683102 947146538 2
248965421 -582424874 1207857255
-626304190 -686639862 1611239785
-268684147 -742315782 1348306368
-578315934 325809384 1011211005
-269313199 205282857 4
-784707969 -664903798 1210029169
124370503 627261757 6
160848827 421145910 1411015933
278363296 -133553161 1860991025
-414523320 -875843184 55281911
-228833704 -971947049 5
-280726827 -531090196 1667551174
-220989831 -136309622 1917758342
-169172490 234977566 1848063719
503100858 231425044 1089367497
619525346 818268916 6
-324383001 -840783684 810928560
-646538746 -717640671 278618169
550229576 159287855 2
226737213 -979975153 1639514313
-72639640 61105667 3
985052974 127825170 8286123
548899068 -444557215 1
-267293925 944279641 7
995387012 929265295 3
-806693229 611585385 1282057435
-143326582 95125015 2
108696328 703340367 707825232
-824110661 58396943 1373717036
-846403704 16513063 1381584014
919872158 347954999 1586019296
-12509412 245618467 1658133980
44963669 450311663 1944766903
-176112587 460566750 1510223270
641583090 -81213903 1594119427
335686806 237798219 2
978542198 932626963 198202129
215318735 989887351 6
-864298264 907249371 1547677503
-909359804 -292704966 1883633946
-560665757 227637512 5
74040408 100449681 2
-313580178 -348282514 1807174197
517519540 -27798887 3
-727807730 412399855 793613701
309238949 -1405237 1
948775025 -297991441 194269484
260893746 134374083 1
`

type testCase struct {
	x int64
	y int64
	n int64
}

func parseTestcases() ([]testCase, error) {
	lines := strings.Split(strings.TrimSpace(rawTestcasesData), "\n")
	out := make([]testCase, 0, len(lines))
	for _, line := range lines {
		line = strings.TrimSpace(line)
		if line == "" {
			continue
		}
		parts := strings.Fields(line)
		if len(parts) != 3 {
			return nil, fmt.Errorf("invalid testcase line: %s", line)
		}
		x, err1 := strconv.ParseInt(parts[0], 10, 64)
		y, err2 := strconv.ParseInt(parts[1], 10, 64)
		n, err3 := strconv.ParseInt(parts[2], 10, 64)
		if err1 != nil || err2 != nil || err3 != nil {
			return nil, fmt.Errorf("invalid numbers in line: %s", line)
		}
		out = append(out, testCase{x: x, y: y, n: n})
	}
	return out, nil
}

func expectedValue(x, y, n int64) int64 {
	const mod int64 = 1000000007
	r := n % 6
	var res int64
	switch r {
	case 1:
		res = x
	case 2:
		res = y
	case 3:
		res = y - x
	case 4:
		res = -x
	case 5:
		res = -y
	case 0:
		res = x - y
	}
	res %= mod
	if res < 0 {
		res += mod
	}
	return res
}

func main() {
	if len(os.Args) != 2 {
		fmt.Println("usage: go run verifierB.go /path/to/binary")
		os.Exit(1)
	}
	bin := os.Args[1]

	testcases, err := parseTestcases()
	if err != nil {
		fmt.Fprintf(os.Stderr, "failed to parse embedded testcases: %v\n", err)
		os.Exit(1)
	}

	for idx, tc := range testcases {
		expect := expectedValue(tc.x, tc.y, tc.n)
		input := fmt.Sprintf("%d %d\n%d\n", tc.x, tc.y, tc.n)
		cmd := exec.Command(bin)
		cmd.Stdin = strings.NewReader(input)
		var out bytes.Buffer
		var stderr bytes.Buffer
		cmd.Stdout = &out
		cmd.Stderr = &stderr
		err := cmd.Run()
		if err != nil {
			fmt.Printf("test %d: runtime error: %v\nstderr: %s\n", idx, err, stderr.String())
			os.Exit(1)
		}
		gotStr := strings.TrimSpace(out.String())
		got, err := strconv.ParseInt(gotStr, 10, 64)
		if err != nil {
			fmt.Printf("test %d: invalid output %s\n", idx, gotStr)
			os.Exit(1)
		}
		if got != expect {
			fmt.Printf("test %d failed: expected %d got %d\n", idx, expect, got)
			os.Exit(1)
		}
	}
	fmt.Printf("All %d tests passed\n", len(testcases))
}
