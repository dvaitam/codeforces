package main

import (
	"bytes"
	"fmt"
	"os"
	"os/exec"
	"strconv"
	"strings"
)

// solve mirrors 1496B.go.
func solve(arr []int64, k int64) int64 {
	set := make(map[int64]struct{}, len(arr))
	var maxVal int64
	for i, x := range arr {
		set[x] = struct{}{}
		if i == 0 || x > maxVal {
			maxVal = x
		}
	}
	if k == 0 {
		return int64(len(set))
	}
	// mex
	var mex int64
	for {
		if _, ok := set[mex]; !ok {
			break
		}
		mex++
	}
	if mex > maxVal {
		return int64(len(set)) + k
	}
	y := (mex + maxVal + 1) / 2
	if _, ok := set[y]; !ok {
		return int64(len(set)) + 1
	}
	return int64(len(set))
}

type testCase struct {
	n int
	k int64
	a []int64
}

// Embedded testcases from testcasesB.txt.
const testcaseData = `
100
5 9
195 16 65 30 126
25 7
120 166 97 53 24 124 7 99 110 155 0 178 114 68 184 58 151 26 81 193 5 6 198 138 2
29 6
175 55 108 185 7 135 56 112 126 141 59 88 189 173 193 117 74 5 106 142 164 25 47 161 75 30 85 128 197
17 10
48 77 72 150 127 129 100 8 122 62 190 103 106 170 44 93 140
29 10
188 95 22 112 169 130 27 41 133 100 94 125 187 7 120 11 78 180 157 151 148 190 165 43 176 128 58 3 51
18 8
59 103 131 88 147 90 117 68 168 140 155 186 1 98 189 33 132 199
18 3
109 14 123 93 145 141 51 129 105 124 91 106 88 0 137 138 159 156
11 7
153 7 58 162 45 140 149 46 23 141 65
2 10
18 21
28 0
115 3 193 197 71 63 68 28 159 47 88 74 17 42 40 65 135 43 168 69 165 75 116 82 127 121 29 6
10 6
87 107 48 66 27 64 186 130 53 155
14 0
57 4 101 37 9 184 41 114 180 129 173 109 139 56
21 8
115 57 134 166 7 101 172 147 82 168 161 109 15 188 76 32 54 12 78 18 19
10 4
190 40 106 144 64 33 2 143 9 151
27 3
145 117 43 180 159 130 9 96 51 88 25 52 146 172 110 151 49 126 26 170 99 75 129 127 4 83 156
28 6
72 4 40 51 83 144 34 86 109 54 68 172 24 97 140 88 175 136 124 182 60 16 10 21 193 43 42 137
7 4
194 85 153 129 65 94 86
11 1
74 60 154 199 183 125 34 148 141 197 26
11 0
104 18 97 37 32 87 29 157 150 96 19
19 8
57 144 20 68 93 75 136 29 117 70 27 11 3 157 171 23 105 10 48
8 9
107 41 29 115 42 174 61 40
24 1
111 96 138 75 140 64 182 122 80 25 53 166 81 10 6 2 196 152 187 115 100 191 102 16
3 5
153 116 28
9 3
158 199 138 176 120 169 91 66 46
18 3
78 50 63 92 20 71 22 192 114 23 166 147 164 86 58 99 10 83
6 5
148 77 62 85 25 139
20 9
152 23 62 56 5 102 18 68 141 186 19 162 2 74 192 91 126 120 39 25
17 5
19 130 170 44 45 198 38 36 81 78 27 181 131 154 75 32 52
5 8
184 8 199 80 159
26 10
141 191 176 52 45 76 110 137 40 12 182 170 63 64 16 174 114 193 140 186 138 112 192 116 2 101
27 5
43 66 124 6 165 106 146 4 15 177 90 148 35 151 32 187 198 70 101 144 102 44 156 22 59 197 1
6 8
81 128 166 112 175 163
24 3
61 80 126 175 122 57 182 105 86 143 156 186 167 70 165 56 12 18 130 185 94 40 181 52
10 4
177 76 141 95 42 179 188 118 152 21
28 1
155 131 146 96 45 39 64 109 55 145 184 13 126 174 100 183 163 89 98 198 42 139 10 134 23 65 160 25
9 1
35 198 157 168 175 179 20 113 61
28 6
110 101 42 83 112 32 159 124 54 30 199 153 136 104 190 169 75 71 63 96 143 1 48 135 195 148 5 7
21 9
62 66 52 44 72 37 138 51 69 79 149 193 64 174 114 43 139 91 125 107 31
25 3
146 98 52 72 27 6 30 145 191 3 139 75 172 185 166 34 19 128 95 199 79 111 182 173 91
25 8
82 0 31 113 183 115 89 78 138 102 86 187 174 146 126 28 165 96 97 52 142 198 71 162 153
24 8
50 118 153 132 104 190 182 78 179 43 115 158 171 135 199 92 134 0 173 99 148 109 103 86
28 9
149 187 179 191 17 126 190 63 163 166 74 161 5 104 184 188 39 162 101 69 45 18 154 2 89 67 105 139
10 2
118 66 124 43 119 130 11 69 25 190
19 6
17 90 168 113 5 42 129 181 41 176 23 102 162 70 154 77 53 135 60
29 5
68 17 19 178 133 168 94 119 130 142 188 12 43 76 167 182 190 69 91 156 59 100 143 102 44 123 66 180 84
23 3
66 156 180 62 169 7 159 103 81 110 63 68 48 18 160 42 148 113 183 37 155 67 117
17 2
35 199 183 112 92 79 192 102 61 29 52 174 78 17 27 58 101
11 7
25 47 11 14 152 5 192 55 174 8 126
23 8
185 156 113 87 169 70 30 198 177 44 24 56 102 59 126 115 96 43 186 60 72 118 140
19 6
54 115 183 66 84 127 151 28 20 11 3 1 122 81 98 148 73 50 102
6 10
38 7 3 99 37 170
18 0
144 97 65 33 20 118 166 77 3 9 137 15 134 10 70 199 30 110
3 3
7 127 163
5 4
175 49 169 114 99
11 10
68 66 164 162 62 15 150 151 44 89 109
20 8
163 133 15 90 140 105 137 51 182 108 169 17 68 190 156 184 192 18 64 45
4 2
15 52 109 11
2 10
23 131
16 8
94 25 80 10 32 136 8 113 170 101 195 181 114 6 188 134
9 1
64 83 21 77 8 98 14 187 66
11 2
66 97 29 173 77 24 108 62 128 142 52
11 5
130 100 149 123 26 33 167 114 134 143 184
28 9
179 133 137 7 74 190 40 51 94 99 198 83 24 104 88 32 147 16 11 76 166 136 80 106 180 81 90 69
11 8
128 2 134 31 38 81 186 83 146 17 115
9 7
116 93 189 97 20 148 14 34 12
17 7
147 64 62 179 146 191 86 92 164 94 103 78 118 153 87 136 129
6 0
37 64 175 56 144 34
30 1
47 196 105 186 158 12 25 139 174 68 182 27 52 66 17 161 146 134 164 20 18 55 181 44 130 110 5 151 94 124
23 4
56 51 153 126 60 108 115 172 93 139 48 123 185 18 65 104 198 2 136 97 131 124 19
13 9
130 148 149 108 10 90 117 1 48 76 178 176 164
1 8
30
27 4
131 191 80 139 165 146 141 72 134 105 138 132 104 154 161 148 78 115 77 33 129 113 150 35 140 41 64
21 0
108 188 169 144 9 94 107 102 72 168 192 171 4 23 1 98 68 118 69 95 162
24 7
196 86 99 116 29 123 90 37 106 192 4 44 66 94 32 150 73 105 187 131 183 107 176 70
14 5
198 124 55 183 125 102 108 23 16 33 52 38 58 186
1 1
64
5 7
198 25 102 166 185
6 0
22 109 156 13 140 55
18 6
88 12 166 26 188 141 173 107 171 189 30 67 175 71 45 122 180 54
22 10
22 99 31 171 114 75 174 130 127 100 29 155 122 27 38 98 157 179 51 42 133 65
14 8
73 126 162 139 54 194 159 86 124 26 2 193 186 168
12 4
14 138 160 112 76 194 25 58 130 70 69 180
8 6
37 33 65 49 104 143 161 153
29 0
136 155 130 38 105 69 71 122 178 78 68 125 54 127 94 153 120 61 86 45 198 46 148 115 199 196 14 129 83
17 2
165 194 54 80 159 126 122 84 30 32 35 178 65 57 22 162 137
27 0
144 44 175 29 57 199 51 128 145 168 78 108 83 1 5 189 157 56 21 195 71 174 160 87 68 153 132
13 0
31 84 88 35 29 64 197 36 174 146 10 19 23
24 1
76 81 63 68 135 12 92 7 20 35 102 95 184 163 176 61 24 173 84 70 2 131 82 28
12 10
185 32 155 69 103 23 173 147 158 135 121 144
14 8
100 77 56 161 140 34 13 153 130 28 44 61 55 111
9 8
5 64 137 69 135 67 121 32 103
23 1
190 95 17 167 139 92 195 142 185 129 175 148 7 158 78 114 174 33 39 19 188 36 173
29 3
123 196 85 93 74 40 39 97 112 103 30 153 37 69 75 170 175 163 154 2 137 180 164 33 192 143 25 117 7
25 6
153 173 108 70 94 104 103 155 118 13 25 120 9 165 180 178 0 10 28 150 35 135 130 91 141
9 9
167 91 121 178 62 159 61 27 143
12 2
29 198 10 180 80 108 186 88 64 168 160 197
30 0
157 111 106 96 91 75 193 87 112 179 60 162 156 132 36 14 192 172 29 131 44 139 164 160 124 183 31 149 5 122
29 3
98 161 44 101 183 58 25 63 85 84 168 62 173 118 120 94 126 166 169 49 110 112 102 138 30 146 124 68 32
5 0
96 106 27 6 167
3 2
117 196 96
`

func parseTestcases() ([]testCase, error) {
	fields := strings.Fields(testcaseData)
	if len(fields) == 0 {
		return nil, fmt.Errorf("no test data")
	}
	pos := 0
	t, err := strconv.Atoi(fields[pos])
	if err != nil {
		return nil, fmt.Errorf("bad t: %v", err)
	}
	pos++
	res := make([]testCase, 0, t)
	for caseIdx := 0; caseIdx < t; caseIdx++ {
		if pos+1 >= len(fields) {
			return nil, fmt.Errorf("case %d incomplete", caseIdx+1)
		}
		n, err := strconv.Atoi(fields[pos])
		if err != nil {
			return nil, fmt.Errorf("case %d bad n: %v", caseIdx+1, err)
		}
		pos++
		k, err := strconv.ParseInt(fields[pos], 10, 64)
		if err != nil {
			return nil, fmt.Errorf("case %d bad k: %v", caseIdx+1, err)
		}
		pos++
		arr := make([]int64, n)
		for i := 0; i < n; i++ {
			if pos >= len(fields) {
				return nil, fmt.Errorf("case %d missing array values", caseIdx+1)
			}
			val, err := strconv.ParseInt(fields[pos], 10, 64)
			if err != nil {
				return nil, fmt.Errorf("case %d bad value %d: %v", caseIdx+1, i+1, err)
			}
			arr[i] = val
			pos++
		}
		res = append(res, testCase{n: n, k: k, a: arr})
	}
	if pos != len(fields) {
		return nil, fmt.Errorf("extra tokens at end")
	}
	return res, nil
}

func runCandidate(bin, input string) (string, error) {
	var cmd *exec.Cmd
	if strings.HasSuffix(bin, ".go") {
		cmd = exec.Command("go", "run", bin)
	} else {
		cmd = exec.Command(bin)
	}
	cmd.Stdin = strings.NewReader(input)
	var out bytes.Buffer
	var errb bytes.Buffer
	cmd.Stdout = &out
	cmd.Stderr = &errb
	if err := cmd.Run(); err != nil {
		return "", fmt.Errorf("runtime error: %v\n%s", err, errb.String())
	}
	return strings.TrimSpace(out.String()), nil
}

func main() {
	args := os.Args[1:]
	if len(args) == 2 && args[0] == "--" {
		args = args[1:]
	}
	if len(args) != 1 {
		fmt.Println("usage: go run verifierB.go /path/to/binary")
		os.Exit(1)
	}
	bin := args[0]

	tests, err := parseTestcases()
	if err != nil {
		fmt.Fprintln(os.Stderr, err)
		os.Exit(1)
	}

	for idx, tc := range tests {
		var sb strings.Builder
		sb.WriteString(fmt.Sprintf("%d\n", 1))
		sb.WriteString(fmt.Sprintf("%d %d\n", tc.n, tc.k))
		for i, v := range tc.a {
			if i > 0 {
				sb.WriteByte(' ')
			}
			sb.WriteString(fmt.Sprint(v))
		}
		sb.WriteByte('\n')
		expected := strconv.FormatInt(solve(tc.a, tc.k), 10)
		got, err := runCandidate(bin, sb.String())
		if err != nil {
			fmt.Printf("test %d failed: %v\n", idx+1, err)
			os.Exit(1)
		}
		if strings.TrimSpace(got) != expected {
			fmt.Printf("test %d failed\ninput:\n%sexpected: %s\ngot: %s\n", idx+1, sb.String(), expected, got)
			os.Exit(1)
		}
	}
	fmt.Printf("All %d tests passed\n", len(tests))
}
