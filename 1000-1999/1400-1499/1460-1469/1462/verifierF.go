package main

import (
	"bytes"
	"fmt"
	"os"
	"os/exec"
	"sort"
	"strconv"
	"strings"
)

// solve mirrors 1462F.go for one test case.
func solve(segs [][2]int) int {
	n := len(segs)
	L := make([]int, n)
	R := make([]int, n)
	for i, seg := range segs {
		L[i] = seg[0]
		R[i] = seg[1]
	}
	sortedL := append([]int(nil), L...)
	sortedR := append([]int(nil), R...)
	sort.Ints(sortedL)
	sort.Ints(sortedR)
	maxc := 0
	for i := 0; i < n; i++ {
		x := sort.Search(n, func(j int) bool { return sortedL[j] > R[i] })
		y := sort.Search(n, func(j int) bool { return sortedR[j] >= L[i] })
		c := x - y
		if c > maxc {
			maxc = c
		}
	}
	return n - maxc
}

type testCase struct {
	segs [][2]int
}

// Embedded testcases from testcasesF.txt.
const testcaseData = `
100
11
86 166
184 206
546 576
722 784
538 616
618 629
443 515
526 555
522 613
343 377
528 576
15
112 184
1 84
773 825
895 905
353 390
559 653
60 66
381 404
1000 1012
253 298
532 536
771 813
562 592
587 615
325 336
3
57 69
905 946
512 561
13
510 553
368 448
48 146
136 193
96 165
350 367
424 467
33 89
944 996
626 648
366 425
824 883
246 291
19
638 737
14 100
592 620
792 861
78 109
903 914
622 644
427 483
247 346
691 729
629 714
629 642
5 68
813 894
60 62
913 932
710 792
762 768
808 898
16
138 162
445 463
817 898
41 67
169 240
733 735
214 222
982 1001
551 650
5 30
411 510
654 748
724 794
827 911
804 896
750 811
20
10 101
473 539
410 444
802 804
786 842
722 815
898 920
498 523
76 100
476 479
333 433
858 907
868 883
842 929
408 431
395 473
745 814
758 812
320 342
977 1029
18
274 357
537 552
960 1060
426 520
752 763
359 440
10 109
555 616
304 397
400 472
453 534
508 553
828 889
518 582
251 254
927 973
236 267
316 348
14
448 483
289 305
26 56
139 217
510 536
576 646
888 972
507 570
57 135
674 744
484 489
19 108
740 819
104 191
8
590 599
553 583
156 210
583 667
666 758
786 824
805 823
651 734
7
266 344
931 1004
471 508
288 306
704 736
232 302
729 782
7
252 338
41 106
799 816
889 924
604 650
228 261
938 966
1
537 614
3
505 539
553 580
32 77
13
430 486
569 616
439 529
927 1026
804 896
798 831
287 356
298 384
348 421
298 298
752 752
375 466
128 176
12
907 983
511 611
492 582
375 446
815 834
162 164
405 480
251 264
780 797
905 1005
928 953
310 345
15
612 704
265 293
310 317
532 550
821 850
614 659
990 1032
854 954
676 748
206 267
120 201
510 542
208 258
420 425
961 1016
2
390 399
475 501
11
1000 1002
860 878
454 518
997 1090
471 557
431 495
37 53
154 182
503 599
76 81
71 139
1
956 956
18
333 417
68 114
47 74
482 552
73 147
205 300
776 815
316 319
228 290
653 675
779 809
949 993
995 1075
1000 1006
64 146
463 503
940 1008
386 391
2
932 998
17 40
18
74 104
500 586
803 873
567 631
245 252
226 282
12 28
993 1089
45 66
464 494
914 974
98 183
893 984
748 788
696 764
441 523
587 643
778 850
8
254 262
274 367
385 446
402 486
185 221
973 1063
300 377
269 269
7
835 863
237 296
8 19
856 906
331 339
509 510
732 778
15
676 739
51 86
578 664
279 304
178 254
862 933
260 292
526 537
978 991
418 466
542 550
791 835
659 738
272 305
440 497
15
419 471
723 776
260 360
105 124
938 1035
898 967
544 615
628 702
430 520
863 865
326 349
410 502
925 1013
539 630
308 312
11
696 791
938 939
31 32
254 300
207 216
212 217
222 304
610 685
946 969
355 425
556 591
14
818 831
711 774
897 985
155 209
617 617
368 390
601 662
342 342
1 35
216 283
589 659
771 793
731 781
622 682
19
870 932
208 236
377 438
942 1017
372 441
442 508
303 358
970 1002
291 353
619 631
757 846
49 49
771 805
399 465
666 748
403 427
672 763
59 107
585 652
1
696 782
11
509 540
372 440
339 422
605 684
64 154
35 63
452 504
509 602
284 320
612 623
924 926
9
93 106
243 311
879 974
1000 1073
332 361
169 231
812 864
786 801
904 949
2
96 115
893 908
4
980 1029
497 546
179 219
508 511
18
789 879
198 237
338 425
604 687
993 1023
174 223
516 591
304 338
107 156
535 632
667 711
84 176
850 883
384 410
607 694
442 528
769 813
95 95
16
711 805
864 867
250 259
862 945
300 386
116 188
259 314
54 86
835 932
110 199
735 808
386 412
548 595
949 975
156 214
72 141
13
767 867
125 189
186 252
865 879
459 485
179 272
761 801
883 977
161 237
5 94
732 770
447 500
864 869
7
576 585
876 939
884 906
950 1044
236 294
812 900
743 802
1
403 417
9
220 294
396 420
940 951
104 119
960 1011
919 1014
992 1085
739 765
968 1007
1
119 165
17
226 298
885 888
400 404
142 155
141 229
78 135
917 964
222 301
922 943
710 800
703 737
836 846
876 959
704 757
329 420
298 381
322 394
18
784 798
927 1014
911 941
195 246
420 438
612 621
761 791
229 266
960 1051
763 818
296 348
51 131
64 114
402 437
954 957
819 870
105 105
116 188
1
293 298
1
986 1035
18
981 1060
576 673
147 209
97 197
863 874
587 593
992 1044
211 242
242 342
1 10
98 182
754 781
795 878
814 840
926 982
878 925
552 595
722 766
20
11 66
399 447
608 669
427 468
843 862
8 35
821 847
412 462
971 987
762 861
502 600
274 358
947 1029
576 645
805 810
427 468
194 196
425 466
183 197
670 700
11
934 984
692 732
325 348
200 298
602 633
840 888
112 161
789 864
575 655
611 642
761 857
10
9 32
602 640
371 412
944 1009
345 420
419 513
933 989
976 999
358 368
254 300
12
205 209
335 400
853 941
958 1039
966 978
384 416
581 661
25 35
970 1005
139 195
981 1016
886 923
3
549 558
609 626
967 1042
4
68 136
251 327
58 74
576 619
4
78 178
144 240
591 613
852 950
12
138 171
541 601
669 760
285 316
717 785
777 777
302 329
358 383
392 455
336 368
965 966
610 710
5
272 301
312 350
144 175
333 352
575 586
4
512 555
833 911
88 117
684 770
10
165 170
283 284
28 38
315 348
679 719
437 490
139 222
682 760
707 774
658 672
20
850 903
461 506
309 382
488 501
908 964
711 765
920 934
448 461
313 370
272 293
401 478
135 207
418 442
142 162
530 541
236 260
376 414
811 848
814 872
504 568
20
43 86
285 322
441 531
569 632
602 604
289 343
20 44
740 828
81 111
293 375
520 603
231 233
426 436
605 672
230 240
270 355
101 175
391 476
728 776
901 916
15
89 90
276 296
367 430
242 269
300 345
198 297
155 173
669 732
218 281
923 946
157 198
281 368
16 35
268 348
79 159
15
522 590
248 302
955 1050
246 303
659 727
59 146
378 391
437 472
582 656
68 150
511 555
194 205
190 198
32 87
127 170
19
331 345
701 721
921 963
308 375
914 928
859 928
139 182
424 504
191 279
149 154
347 386
791 816
256 292
449 449
532 564
545 644
125 204
965 1046
14 40
6
723 796
980 1032
26 42
463 559
416 472
521 579
11
745 842
997 1063
687 780
696 752
495 506
278 286
439 520
201 300
737 819
82 92
359 369
13
712 762
884 975
427 451
352 415
44 84
515 532
314 351
588 680
712 713
969 985
58 79
565 600
332 383
20
258 309
735 764
201 243
494 575
878 919
182 185
890 986
278 296
775 809
229 329
746 846
526 625
601 685
807 858
935 1020
866 881
431 489
452 504
683 735
91 92
7
317 317
236 310
862 949
649 736
983 1082
136 159
914 962
6
206 260
911 1003
638 705
999 1004
932 954
18 22
20
719 736
284 319
276 374
612 664
204 213
86 88
308 335
551 618
685 687
684 725
718 785
65 133
331 360
626 695
74 131
496 557
567 640
731 811
580 636
578 651
15
244 343
799 873
827 840
558 628
50 126
663 667
58 112
619 671
953 1014
212 215
331 331
448 535
605 631
803 866
600 611
19
108 143
896 975
418 434
725 761
196 284
32 127
757 780
444 514
225 314
972 1019
692 699
685 703
408 466
404 416
393 431
62 96
235 253
390 463
939 1023
6
330 427
225 290
63 109
411 463
29 59
76 123
6
501 595
555 567
729 798
795 807
919 980
535 581
16
668 670
165 232
183 239
212 301
512 528
438 476
920 984
64 123
169 193
870 932
74 90
395 468
927 940
230 282
782 845
307 390
10
541 556
73 165
449 503
710 805
834 882
195 212
360 369
928 930
268 356
710 739
11
87 105
955 1040
225 289
417 423
963 999
8 106
896 905
792 868
436 512
70 118
540 611
18
46 138
629 637
809 906
118 142
66 154
425 517
625 699
756 829
780 784
907 958
326 401
721 770
674 674
503 571
310 357
483 574
57 89
892 892
10
290 321
181 265
306 334
573 585
703 727
656 685
459 512
845 859
918 918
523 539
6
100 200
189 238
563 633
680 705
451 512
202 231
3
311 328
787 884
631 730
2
435 470
884 921
17
575 609
563 642
897 983
948 1008
407 497
261 331
345 393
682 774
735 744
764 839
853 865
863 923
70 86
344 390
71 123
717 752
742 793
6
316 381
312 386
858 865
535 574
533 552
488 512
14
649 734
43 133
707 733
297 371
864 899
952 961
944 1037
655 755
591 648
766 786
712 789
283 293
330 337
170 192
14
352 394
11 20
152 235
685 731
733 778
904 958
26 72
717 725
856 929
600 644
668 744
351 369
472 485
790 884
20
568 625
136 229
458 506
494 565
317 410
766 852
669 731
982 1009
433 473
25 87
985 1037
152 229
302 402
322 349
114 139
131 224
603 655
41 121
784 877
504 590
11
753 787
339 419
496 509
3 101
31 78
662 697
432 519
593 622
398 426
592 681
70 145
4
667 701
907 982
18 68
838 875
12
416 439
370 418
618 692
731 746
829 929
757 828
779 833
341 374
343 355
634 656
455 485
195 207
15
718 739
4 90
639 662
365 459
57 151
313 343
166 176
551 645
335 396
631 641
586 660
334 337
41 82
118 131
426 487
13
592 636
283 360
588 660
830 834
248 329
278 303
682 766
751 821
2 97
645 711
507 591
6 103
517 520
1
77 99
12
472 535
828 898
97 196
858 909
164 234
801 894
755 814
191 238
477 497
68 127
833 836
478 527
20
81 87
791 850
890 964
853 863
116 189
157 241
451 471
747 819
36 51
45 100
383 426
126 173
426 489
630 643
62 86
128 150
469 470
506 559
554 571
611 691
1
748 765
13
113 128
519 587
236 326
254 330
26 40
681 779
85 90
789 872
628 669
966 990
374 388
324 340
326 354
19
873 879
703 770
557 619
104 178
135 219
702 777
336 397
157 221
184 246
657 701
139 144
706 727
710 745
356 399
251 285
599 651
295 377
959 999
639 641
16
826 863
951 1051
156 243
266 290
893 895
867 929
787 826
737 833
487 488
103 150
745 776
891 968
664 735
246 295
199 282
797 846
4
181 213
868 880
290 311
574 591
`

func parseTestcases() ([]testCase, error) {
	fields := strings.Fields(testcaseData)
	if len(fields) == 0 {
		return nil, fmt.Errorf("no embedded testcases")
	}
	pos := 0
	t, err := strconv.Atoi(fields[pos])
	if err != nil {
		return nil, fmt.Errorf("bad t: %v", err)
	}
	pos++
	res := make([]testCase, 0, t)
	for i := 0; i < t; i++ {
		if pos >= len(fields) {
			return nil, fmt.Errorf("case %d missing n", i+1)
		}
		n, err := strconv.Atoi(fields[pos])
		if err != nil {
			return nil, fmt.Errorf("case %d bad n: %v", i+1, err)
		}
		pos++
		if pos+2*n > len(fields) {
			return nil, fmt.Errorf("case %d missing segment data", i+1)
		}
		segs := make([][2]int, n)
		for j := 0; j < n; j++ {
			l, err := strconv.Atoi(fields[pos+2*j])
			if err != nil {
				return nil, fmt.Errorf("case %d bad l%d: %v", i+1, j+1, err)
			}
			r, err := strconv.Atoi(fields[pos+2*j+1])
			if err != nil {
				return nil, fmt.Errorf("case %d bad r%d: %v", i+1, j+1, err)
			}
			segs[j] = [2]int{l, r}
		}
		pos += 2 * n
		res = append(res, testCase{segs: segs})
	}
	if pos != len(fields) {
		return nil, fmt.Errorf("testcase count mismatch: read %d tokens, have %d", pos, len(fields))
	}
	return res, nil
}

func runCandidate(bin, input string) (string, error) {
	var cmd *exec.Cmd
	if strings.HasSuffix(bin, ".go") {
		cmd = exec.Command("go", "run", bin)
	} else {
		cmd = exec.Command(bin)
	}
	cmd.Stdin = strings.NewReader(input)
	var out bytes.Buffer
	var errb bytes.Buffer
	cmd.Stdout = &out
	cmd.Stderr = &errb
	if err := cmd.Run(); err != nil {
		return "", fmt.Errorf("runtime error: %v\n%s", err, errb.String())
	}
	return strings.TrimSpace(out.String()), nil
}

func main() {
	args := os.Args[1:]
	if len(args) == 2 && args[0] == "--" {
		args = args[1:]
	}
	if len(args) != 1 {
		fmt.Println("usage: go run verifierF.go /path/to/binary")
		os.Exit(1)
	}
	bin := args[0]

	tests, err := parseTestcases()
	if err != nil {
		fmt.Fprintln(os.Stderr, err)
		os.Exit(1)
	}

	for idx, tc := range tests {
		var sb strings.Builder
		sb.WriteString("1\n")
		sb.WriteString(fmt.Sprintln(len(tc.segs)))
		for _, seg := range tc.segs {
			sb.WriteString(fmt.Sprintf("%d %d\n", seg[0], seg[1]))
		}
		expected := strconv.Itoa(solve(tc.segs))
		got, err := runCandidate(bin, sb.String())
		if err != nil {
			fmt.Printf("test %d failed: %v\n", idx+1, err)
			os.Exit(1)
		}
		if strings.TrimSpace(got) != expected {
			fmt.Printf("test %d failed\ninput:\n%sexpected: %s\ngot: %s\n", idx+1, sb.String(), expected, got)
			os.Exit(1)
		}
	}
	fmt.Printf("All %d tests passed\n", len(tests))
}
