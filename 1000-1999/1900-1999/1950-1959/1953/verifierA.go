package main

import (
	"fmt"
	"os"
	"os/exec"
	"strconv"
	"strings"
)

const testcasesA = `7 -414.927 197.831 -162.374 233.726 -405.359 -491.164 -244.305
10 131.342 178.34 -432.843 -178.61 -289.813 465.528 -179.320 -26.804 -382.301 166.103
5 -78.47 -141.138 -221.850 67.338 -112.643
9 423.632 -281.935 -337.310 488.721 6.511 -185.410 355.314 459.791 -331.969
7 -46.289 -78.553 240.21 304.218 152.104 -421.544 399.899
7 -203.13 139.388 -343.360 332.933 -275.303 181.341 -308.264
9 -119.176 81.811 -97.402 -297.438 -8.263 -213.577 -24.636 82.571 -321.77
1 116.873
8 77.168 191.688 25.531 -336.336 426.704 -471.353 -378.137 306.952
5 -15.463 116.652 -282.490 392.139 445.939
7 -83.488 -184.794 -381.238 -201.159 319.474 58.975 158.980
2 38.711 225.485
3 89.228 56.935 175.167
1 -383.509
6 -150.301 243.92 -480.71 -290.810 82.909 -256.921
7 131.726 -316.16 216.582 15.310 92.473 -160.343 398.157
2 16.195 -272.402
7 -277.270 -412.764 18.904 472.657 178.337 -348.825 -371.672
9 347.282 148.693 186.756 258.341 -239.238 -357.41 148.810 -155.365 -32.4
4 157.455 -208.591 190.542 284.490
3 367.936 -399.283 -369.160
8 381.809 -474.980 240.569 -202.288 -384.54 -122.654 -183.139 -272.873
6 80.190 -414.43 294.865 478.113 269.906 -380.686
1 -198.497
1 -122.35
6 214.160 101.312 439.687 -125.334 392.112 -459.162
6 -158.789 -315.24 97.8 97.496 -72.59 98.179
9 20.570 -168.156 130.338 369.587 -95.366 194.667 46.647 -18.258 125.260
3 237.223 -433.595 -75.37
4 -185.394 126.440 -404.304 -304.247
10 129.188 450.979 -106.980 221.730 220.235 469.63 -146.32 488.674 37.958 304.872
8 370.458 -479.41 96.760 -303.889 -215.837 -425.439 -359.938 222.525
7 -106.20 -132.470 -26.819 332.632 374.45 -241.506 270.268
8 -385.89 8.530 -240.5 -233.560 119.447 443.657 -477.225 -200.804
7 -284.387 -11.338 -45.763 -81.845 -153.961 76.68 -128.25
8 -323.199 -269.509 -465.659 -319.796 21.135 294.657 -447.116 386.613
10 339.34 -94.962 -56.443 479.191 -378.581 389.996 -142.60 -243.423 -175.887 -469.665
4 -348.803 498.589 212.835 -282.640
2 487.747 -28.497
6 328.164 -291.592 -274.252 212.341 -136.975 -165.940
10 465.540 -195.276 114.819 -491.406 318.842 435.910 32.24 -62.290 -125.389 256.526
1 272.800
9 79.87 425.849 265.71 314.115 -84.386 -299.269 279.190 -114.164 250.833
4 -458.958 312.813 -240.310 -184.290
4 -217.492 161.11 290.882 219.137
4 266.591 -147.723 198.230 53.46
1 -135.61
5 -466.872 -202.72 -305.47 485.283 -450.102
2 383.897 -450.525
10 465.706 308.980 -348.786 122.352 -77.508 31.771 115.88 90.518 221.709 252.591
7 457.599 -325.995 151.659 -203.584 -34.764 -327.154 245.982
8 339.630 60.831 405.827 -189.635 -325.537 -269.50 346.43 134.232
5 261.250 19.756 301.203 343.533 -324.268
6 151.394 199.593 105.38 280.901 286.751 -126.25
1 -171.194
6 -272.360 121.709 4.530 275.1 394.451 142.966
3 89.210 -63.805 155.131
10 353.97 -314.972 322.624 327.361 73.610 -168.362 438.146 336.489 476.170 8.720
1 199.889
4 413.526 -151.18 202.516 -436.277
8 245.825 -311.598 419.416 315.998 444.640 192.148 496.967 -50.856
1 429.730
6 158.52 86.443 -57.741 236.59 -196.315 421.937
1 120.55
5 202.731 -265.546 -12.879 415.51 -106.83
7 234.181 398.771 354.473 292.670 423.181 -104.245 356.244
4 -381.637 232.210 275.317 -299.66
3 -393.975 452.760 -374.602
1 72.861
1 -122.808
6 -272.650 -271.599 20.615 -404.459 11.252 303.962
1 475.911
4 358.378 -336.434 -451.10 153.783
9 -156.142 -60.185 281.169 232.820 44.229 46.3 160.966 314.566 -251.86
7 190.525 405.72 240.1 -98.861 425.873 -164.144 -89.6
4 -89.345 313.230 -464.59 309.433
4 436.906 -380.3 362.572 105.772
8 -351.299 -198.32 -306.183 206.964 413.657 432.129 51.814 436.898
8 26.132 -10.51 -475.12 -491.562 214.797 -17.374 -137.686 -312.997
2 494.169 -54.745
5 94.734 306.5 -153.952 116.973 217.59
8 234.664 453.215 26.288 -333.444 -328.36 390.291 390.12 309.163
2 8.247 232.6
3 388.935 -292.702 496.327
1 207.159
3 193.16 -423.16 -218.973
7 250.851 16.750 177.36 125.937 18.458 452.974 5.813
2 -392.726 18.487
7 -474.703 73.679 -139.992 -99.376 95.286 496.125 -423.310
2 -416.551 -454.885
3 428.351 360.42 229.504
5 -97.107 56.376 -69.284 361.130 276.300
2 161.400 -173.775
5 -78.616 477.34 373.648 -472.257 355.800
7 -38.981 -29.10 161.821 -398.184 -474.151 476.875 245.123
6 -109.505 41.845 -350.50 -155.447 -441.691 10.625
3 14.691 331.802 -494.966
7 218.799 -221.691 -168.797 74.880 70.624 164.519 69.871
2 136.187 131.579
1 141.732
3 -118.420 432.278 22.978
2 -12.622 -393.233
1 3.530
3 -453.624 121.794 -452.678
9 -410.68 74.111 396.107 -363.6 368.2 383.489 26.848 378.974 -57.202
4 -232.895 -117.767 -470.80 215.405
10 -54.236 360.460 -204.165 -7.24 -232.362 -382.821 -487.877 -261.424 317.485 450.853
3 149.6 168.8 39.957
4 -268.540 -495.78 -72.781 486.291
7 407.863 445.299 259.548 -353.706 321.606 85.946 -53.5
3 -83.521 459.899 50.862
2 63.686 3.965
5 159.582 -370.796 398.224 -183.311 456.61
5 -405.493 -20.141 -464.17 414.710 99.0
4 206.349 378.793 266.455 193.898
7 486.577 -253.411 -190.266 -471.353 369.563 136.209 292.103`

func expectedFromN(n int) string {
	var b strings.Builder
	b.WriteString("{d:")
	for i := 1; i <= n; i++ {
		if i > 1 {
			b.WriteByte(',')
		}
		b.WriteString(strconv.Itoa(i))
	}
	b.WriteByte('}')
	return b.String()
}

func parseCase(line string) (string, string, error) {
	fields := strings.Fields(line)
	if len(fields) == 0 {
		return "", "", fmt.Errorf("empty line")
	}
	n, err := strconv.Atoi(fields[0])
	if err != nil {
		return "", "", fmt.Errorf("bad n: %w", err)
	}
	if len(fields)-1 != n {
		return "", "", fmt.Errorf("expected %d numbers, got %d", n, len(fields)-1)
	}
	input := line + "\n"
	expected := expectedFromN(n)
	return input, expected, nil
}

func runCandidate(bin, input string) (string, error) {
	cmd := exec.Command(bin)
	cmd.Stdin = strings.NewReader(input)
	out, err := cmd.CombinedOutput()
	if err != nil {
		return "", fmt.Errorf("runtime error: %v\n%s", err, string(out))
	}
	return strings.TrimSpace(string(out)), nil
}

func main() {
	if len(os.Args) != 2 {
		fmt.Println("usage: verifierA /path/to/binary")
		os.Exit(1)
	}
	lines := strings.Split(testcasesA, "\n")
	idx := 0
	for _, raw := range lines {
		line := strings.TrimSpace(raw)
		if line == "" {
			continue
		}
		idx++
		input, expected, err := parseCase(line)
		if err != nil {
			fmt.Fprintf(os.Stderr, "case %d parse error: %v\n", idx, err)
			os.Exit(1)
		}
		got, err := runCandidate(os.Args[1], input)
		if err != nil {
			fmt.Printf("case %d: %v\n", idx, err)
			os.Exit(1)
		}
		if got != expected {
			fmt.Printf("case %d failed: expected %q got %q\n", idx, expected, got)
			os.Exit(1)
		}
	}
	fmt.Printf("All %d tests passed\n", idx)
}
